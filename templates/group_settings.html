{% extends "base.html" %}

{% block title %}Group Settings | HRM{% endblock %}

{% block styles %}
<style>
.group-settings-container {
    max-width: 1200px;
    margin: 32px auto 0 auto;
    padding: 0 24px 48px 24px;
}
.group-settings-header {
    margin-bottom: 24px;
}
.group-settings-back {
    color: #222;
    font-size: 0.95rem;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 18px;
    font-weight: 500;
}
.group-settings-title-row {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 8px;
}
.group-settings-title {
    font-size: 2rem;
    font-weight: 600;
    color: #222;
}
.status-badge {
    background: #e6f7ec;
    color: #1ca97a;
    font-size: 0.95rem;
    font-weight: 500;
    border-radius: 16px;
    padding: 4px 14px;
    display: inline-block;
    margin-left: 4px;
}
.group-settings-tabs {
    display: flex;
    gap: 32px;
    margin-bottom: 32px;
}
.group-settings-tab {
    font-size: 1.05rem;
    color: #222;
    padding: 12px 0;
    cursor: pointer;
    border: none;
    background: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: border 0.2s;
}
.group-settings-tab.active {
    border-bottom: 2px solid #222;
    color: #222;
}
.group-settings-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
}
@media (max-width: 900px) {
    .group-settings-cards {
        grid-template-columns: 1fr;
    }
}
.group-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 24px 24px 18px 24px;
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
    gap: 18px;
}
.group-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
}
.group-card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #222;
}
.group-card-edit-btn {
    background: #f5f5f5;
    border: none;
    border-radius: 8px;
    padding: 6px 18px;
    font-size: 1rem;
    color: #222;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}
.group-card-edit-btn:hover {
    background: #ececec;
}
.group-card-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #fafbfc;
    border-radius: 8px;
    padding: 14px 18px;
    font-size: 1rem;
    color: #222;
}
.group-card-row-label {
    color: #888;
    font-size: 1rem;
}
.group-card-row-value {
    font-weight: 500;
}
.group-card-info {
    color: #666;
    font-size: 0.98rem;
    margin-bottom: 0;
}
.group-card-link {
    color: #1a73e8;
    text-decoration: underline;
    font-size: 0.98rem;
}
.group-card-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 8px 0 0 0;
}
.group-card-toggle-label {
    font-size: 1rem;
    color: #222;
    font-weight: 500;
}
.group-card-toggle-new {
    background: #e6e6fa;
    color: #7c3aed;
    font-size: 0.8rem;
    font-weight: 600;
    border-radius: 8px;
    padding: 2px 8px;
    margin-left: 8px;
}
.group-card-policy-btn {
    background: #f5f5f5;
    border: none;
    border-radius: 8px;
    padding: 7px 18px;
    font-size: 1rem;
    color: #222;
    font-weight: 500;
    cursor: pointer;
    margin-top: 8px;
    margin-right: 8px;
    transition: background 0.2s;
}
.group-card-policy-btn:hover {
    background: #ececec;
}
.group-card-policy-default {
    color: #888;
    font-size: 1rem;
    font-weight: 500;
    margin-left: 8px;
}
.group-card-archive-btn {
    background: #fff;
    border: 1.5px solid #222;
    border-radius: 8px;
    padding: 8px 22px;
    font-size: 1rem;
    color: #222;
    font-weight: 500;
    cursor: pointer;
    margin-top: 8px;
    transition: background 0.2s, border 0.2s;
}
.group-card-archive-btn:hover {
    background: #f5f5f5;
    border-color: #888;
}
.group-name-row {
    background: #e5e7eb;
    border: 2px solid #b0b3b8;
    color: #222;
    font-size: 1.08rem;
    font-weight: 600;
    box-shadow: none;
}

/* Table styles from worker type page */
.worker-types-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: white;
    border: none;
    border-radius: 0;
    overflow: visible;
}

.worker-types-table th {
    padding: 16px;
    text-align: left;
    font-size: 0.875rem;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid #e9ecef;
    border-right: 1px solid #e9ecef;
    background: #f8f9fa;
    user-select: none;
    position: relative;
    transition: background-color 0.2s ease;
}

.worker-types-table th .sort-icon {
    display: inline-block;
    margin-left: 8px;
    width: 12px;
    height: 12px;
    opacity: 0;
    transition: opacity 0.2s ease;
    vertical-align: baseline;
    transform: translateY(-2px);
    cursor: pointer;
}

.worker-types-table th .sort-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    vertical-align: middle;
    transition: none;
}

.worker-types-table th.sortable:hover .sort-icon,
.worker-types-table th.sorted .sort-icon {
    opacity: 1;
}

.worker-types-table th:last-child {
    border-right: none;
}

.worker-types-table td {
    padding: 16px;
    border-bottom: 1px solid #e9ecef;
    border-right: 1px solid #e9ecef;
    font-size: 0.875rem;
    color: #495057;
    vertical-align: middle;
}

.worker-types-table td:last-child {
    border-right: none;
}

.worker-types-table tr:last-child td {
    border-bottom: none;
}

.worker-types-table tr:hover {
    background: #f8f9fa;
}

.worker-types-table thead tr:first-child th:first-child {
    border-top-left-radius: 0;
}

.worker-types-table thead tr:first-child th:last-child {
    border-top-right-radius: 0;
}

.worker-types-table tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
}

.worker-types-table tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
}

/* Edit button styles */
.edit-btn {
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
}

.edit-btn:hover {
    background: #f8f9fa;
    opacity: 1;
    transform: scale(1.1);
}

.edit-btn:active {
    transform: scale(0.95);
}

/* Actions column width */
.worker-types-table td:last-child,
.worker-types-table th:last-child {
    width: 60px;
    text-align: center;
    padding: 12px 8px;
    position: relative;
}

/* Header menu icon styles */
.header-menu-icon {
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    opacity: 0;
    cursor: pointer;
    transition: opacity 0.2s ease;
    z-index: 2;
    padding: 0;
    margin: 0;
    display: inline-block;
    vertical-align: middle;
}

.worker-types-table th:hover .header-menu-icon {
    opacity: 0.7;
}

.header-menu-icon:hover {
    opacity: 1;
}

/* Header dropdown menu styles */
.header-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.05);
    min-width: 180px;
    z-index: 1001;
    display: none;
    padding: 6px 0;
    margin-top: 4px;
    animation: fadeIn 0.15s ease-out;
}

.header-dropdown.positioned-above {
    top: auto;
    bottom: 100%;
    margin-top: 0;
    margin-bottom: 4px;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-4px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.header-dropdown.show {
    display: block;
}

.dropdown-item {
    padding: 10px 14px;
    font-size: 0.875rem;
    color: #374151;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.15s ease;
    position: relative;
    font-weight: 500;
}

.dropdown-item:hover {
    background-color: #f8fafc;
    color: #1f2937;
    padding-left: 16px;
}

.dropdown-item:first-child {
    margin-top: 2px;
}

.dropdown-item:last-child {
    margin-bottom: 2px;
}

.dropdown-item img {
    width: 14px;
    height: 14px;
    opacity: 0.7;
    transition: opacity 0.15s ease;
}

.dropdown-item:hover img {
    opacity: 1;
}

/* Edit Group Name Modal Styles */
.edit-group-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 2000;
    display: none;
}

.edit-group-modal-overlay.show {
    display: block;
}

.edit-group-modal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 32px rgba(0,0,0,0.18);
    width: 400px;
    max-width: 95vw;
    z-index: 2100;
    padding: 0;
    display: none;
}

.edit-group-modal.show {
    display: block;
}

.edit-group-modal-header {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 28px 32px 0 32px;
    position: relative;
}

.edit-group-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111;
    margin: 0;
}

.edit-group-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;
    position: absolute;
    top: 28px;
    right: 32px;
}

.edit-group-modal-content {
    padding: 24px 32px;
}

.edit-group-current {
    margin-bottom: 20px;
    font-size: 0.95rem;
    color: #666;
    text-align: center;
}

.edit-group-form {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.edit-group-label {
    font-size: 0.95rem;
    font-weight: 500;
    color: #222;
    margin-bottom: 4px;
}

.edit-group-input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    font-size: 0.95rem;
    background: white;
    transition: all 0.2s ease;
    box-sizing: border-box;
    font-family: inherit;
}

.edit-group-input:focus {
    outline: none;
    border-color: #80bdff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

.edit-group-char-count {
    font-size: 0.85rem;
    color: #666;
    text-align: right;
    margin-top: 4px;
}

.edit-group-modal-footer {
    padding: 0 32px 32px 32px;
}

.edit-group-save-btn {
    width: 100%;
    background: #e0e0e0;
    color: #999;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    padding: 12px 0;
    cursor: pointer;
    transition: all 0.2s ease;
}

.edit-group-save-btn:enabled {
    background: #222;
    color: #fff;
    cursor: pointer;
}

.edit-group-save-btn:enabled:hover {
    background: #333;
}

/* Archive Group Modal Styles */
.archive-group-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 2000;
    display: none;
}

.archive-group-modal-overlay.show {
    display: block;
}

.archive-group-modal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 32px rgba(0,0,0,0.18);
    width: 400px;
    max-width: 95vw;
    z-index: 2100;
    padding: 0;
    display: none;
}

.archive-group-modal.show {
    display: block;
}

.archive-group-modal-content {
    padding: 32px;
    text-align: center;
}

.archive-group-modal-icon {
    margin-bottom: 24px;
    display: flex;
    justify-content: center;
}

.archive-group-modal-icon-img {
    width: 64px;
    height: 64px;
    object-fit: contain;
}

.archive-group-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111;
    margin: 0 0 16px 0;
}

.archive-group-modal-message {
    font-size: 1rem;
    color: #666;
    margin: 0 0 32px 0;
    line-height: 1.5;
}

.archive-group-modal-footer {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.archive-group-modal-cancel-btn {
    background: #fff;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    padding: 12px 32px;
    font-size: 1rem;
    color: #222;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 120px;
}

.archive-group-modal-cancel-btn:hover {
    background: #f8f9fa;
    border-color: #c1c5c9;
}

.archive-group-modal-confirm-btn {
    background: #222;
    border: none;
    border-radius: 8px;
    padding: 12px 32px;
    font-size: 1rem;
    color: #fff;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 120px;
}

.archive-group-modal-confirm-btn:hover {
    background: #333;
}

/* Actions container */
.actions-container {
    position: relative;
    display: inline-block;
}

/* Action menu popup */
.action-menu {
    position: fixed;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 999;
    min-width: 120px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    overflow: hidden;
}

.action-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Action menu items */
.action-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-size: 0.875rem;
    color: #495057;
}

.action-item:hover {
    background-color: #f8f9fa;
}

.action-item.delete {
    color: #dc3545;
}

.action-item.delete:hover {
    background-color: #f8f9fa;
    color: #dc3545;
}

.action-icon {
    width: 16px;
    height: 16px;
    margin-right: 8px;
    opacity: 0.7;
}

.action-item:hover .action-icon {
    opacity: 1;
}

.action-item.delete .action-icon {
    filter: brightness(0) saturate(100%) invert(24%) sepia(92%) saturate(4159%) hue-rotate(347deg) brightness(91%) contrast(92%);
}

/* Table wrapper and summary */
.table-wrapper {
    border-radius: 12px;
    overflow: visible;
}

.table-summary {
    background: white;
    color: #6c757d;
    font-size: 0.875rem;
    padding: 16px 24px;
    border-bottom: 1px solid #e9ecef;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
}

/* Search container styles */
.search-container {
    position: relative;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: #f8f9fa;
    transition: width 0.3s cubic-bezier(.4,0,.2,1), background 0.2s;
    box-shadow: 0 0 0 1.5px #e0e0e0;
    cursor: pointer;
    overflow: hidden;
}
.search-container.expanded {
    width: 340px;
    background: #f8f9fa;
    cursor: auto;
}
.search-input {
    width: 0;
    opacity: 0;
    border: none;
    outline: none;
    background: transparent;
    font-size: 0.875rem;
    padding: 0;
    margin: 0;
    height: 40px;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.3s cubic-bezier(.4,0,.2,1), opacity 0.2s, padding 0.2s;
}
.search-container.expanded .search-input {
    width: calc(100% - 40px);
    opacity: 1;
    background: #f8f9fa;
    padding: 10px 16px 10px 40px;
    margin: 0;
}
.search-icon {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 18px;
    height: 18px;
    opacity: 0.6;
    pointer-events: none;
    z-index: 2;
    transition: left 0.3s cubic-bezier(.4,0,.2,1), transform 0.3s cubic-bezier(.4,0,.2,1);
}
.search-container.expanded .search-icon {
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state-title {
    font-size: 1.125rem;
    font-weight: 500;
    color: #495057;
    margin-bottom: 8px;
}

.empty-state-description {
    font-size: 0.875rem;
    color: #6c757d;
    margin-bottom: 0;
}

.filters-box {
    background: white;
    border-radius: 12px;
    padding: 24px 32px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
    position: relative;
    z-index: 1;
}
#adminTable td:nth-child(3) {
    color: #222 !important;
}
.admin-checkbox {
    margin-right: 0;
    width: 16px;
    height: 16px;
    accent-color: #1a1a1a;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('/static/images/box.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
    position: relative;
    border-radius: 3px;
    border: none;
    outline: none;
    transition: background 0.2s;
}
.admin-checkbox:checked {
    background-image: none;
    background-color: #1a1a1a;
}
.admin-checkbox:checked::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 4px;
    height: 8px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: translate(-50%, -65%) rotate(45deg);
}
.admin-checkbox:indeterminate {
    background-image: none;
    background-color: #1a1a1a;
}
.admin-checkbox:indeterminate::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 8px;
    height: 2px;
    background: white;
    transform: translate(-50%, -50%);
    border: none;
}
#adminSelectAll.admin-checkbox:checked {
    /* Hide the checkmark for select all */
    background-color: #1a1a1a;
}

/* Remove Admin Modal Styles */
.remove-admin-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 2000;
    display: none;
}
.remove-admin-modal-overlay.show {
    display: block;
}
.remove-admin-modal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 32px rgba(0,0,0,0.18);
    width: 400px;
    max-width: 95vw;
    z-index: 2100;
    padding: 0;
    display: none;
}
.remove-admin-modal.show {
    display: block;
}
.remove-admin-modal-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    padding: 28px 32px 0 32px;
    position: relative;
}
.remove-admin-modal-header-spacer {
    width: 24px;
    height: 24px;
    display: flex;
}
.remove-admin-modal-header-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}
.remove-admin-modal-title {
    text-align: center;
    width: 100%;
    font-weight: 700;
    font-size: 1.5rem;
    color: #111;
}
.remove-admin-modal-subtitle {
    text-align: center;
    width: 100%;
    font-weight: 400;
    font-size: 1rem;
    color: #444;
}
.remove-admin-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;
}
.remove-admin-modal-warning {
    background: #fff8e1;
    border: 1.5px solid #ffe082;
    color: #b26a00;
    border-radius: 8px;
    padding: 14px 18px;
    margin: 24px 32px 0 32px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    font-size: 0.98rem;
}
.remove-admin-modal-warning-icon {
    font-size: 1.2rem;
    margin-top: 2px;
}
.remove-admin-modal-admin {
    background: #f6f7fa;
    border-radius: 10px;
    margin: 24px 32px 0 32px;
    padding: 16px 18px;
    display: flex;
    align-items: center;
    gap: 16px;
}
.remove-admin-modal-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    font-weight: 700;
    color: #7c3aed;
}
.remove-admin-modal-admin-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.remove-admin-modal-admin-name {
    font-weight: 600;
    color: #222;
    font-size: 1.05rem;
}
.remove-admin-modal-admin-role {
    color: #888;
    font-size: 0.98rem;
}
.remove-admin-modal-footer {
    padding: 28px 32px 32px 32px;
}
.remove-admin-modal-remove-btn {
    width: 100%;
    background: #e53935;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1.08rem;
    font-weight: 600;
    padding: 13px 0;
    cursor: pointer;
    transition: background 0.2s;
}
.remove-admin-modal-remove-btn:hover {
    background: #c62828;
}
.status-badge.archived {
    background: #e9ecef !important;
    color: #6c757d !important;
}
</style>
{% endblock %}

{% block content %}
<div class="group-settings-container">
    <div class="group-settings-header">
        <a href="/groups" class="group-settings-back">&larr; Back to Groups</a>
        <div class="group-settings-title-row">
            <span class="group-settings-title">{{ group.name }}</span>
            <span class="status-badge{% if group.status == 'ARCHIVED' %} archived{% endif %}">{{ group.status }}</span>
        </div>
        <div class="group-settings-tabs" id="groupSettingsTabs">
            <button class="group-settings-tab" data-tab="details">Group Details</button>
            <button class="group-settings-tab" data-tab="admins">Admins ({{ admins|length }})</button>
        </div>
    </div>
    <div id="tab-content-details">
        <div class="group-settings-cards">
            <div class="group-card">
                <div class="group-card-header">
                    <span class="group-card-title">Group details</span>
                    <button class="group-card-edit-btn" onclick="showEditGroupNameModal()">Edit</button>
                </div>
                <div class="group-card-row group-name-row">
                    <span class="group-card-row-label">Group name</span>
                    <span class="group-card-row-value">{{ group.name }}</span>
                </div>
            </div>
            <div class="group-card">
                {% if group.status == 'ARCHIVED' %}
                    <div class="group-card-header">
                        <span class="group-card-title">Restore this group</span>
                    </div>
                    <div class="group-card-info">
                        Restored groups will be visible again in your main view and can be used normally.
                    </div>
                    <button class="group-card-archive-btn" onclick="showRestoreGroupModal()">Restore group</button>
                {% else %}
                    <div class="group-card-header">
                        <span class="group-card-title">Archive this group</span>
                    </div>
                    <div class="group-card-info">
                        Archived groups are hidden from your main view but can be accessed by enabling the 'Archived' filter on your groups page. You can restore it at any time.
                    </div>
                    <button class="group-card-archive-btn" onclick="showArchiveGroupModal()">Archive group</button>
                {% endif %}
            </div>
        </div>
    </div>
    <div id="tab-content-admins" style="display:none;">
        <div class="filters-box" style="margin-bottom: 18px;">
            <div class="admin-table-controls" style="display: flex; align-items: center; justify-content: space-between;">
                <div style="flex: 1; max-width: 340px;">
                    <div class="search-container" id="adminSearchContainer" style="position: relative;">
                        <img src="/static/images/search.png" alt="Search" class="search-icon" id="adminSearchIcon" style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; opacity: 0.6;">
                        <input class="search-input" type="text" placeholder="Search by name or email..." id="adminSearchInput" style="width: 100%; padding: 10px 16px 10px 40px; border-radius: 8px; border: 1px solid #e9ecef; background: #f8f9fa;">
                        <button class="search-clear-btn" id="adminSearchClearBtn" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; display: none;">
                            <img src="/static/images/cross.png" alt="Clear" style="width: 16px; height: 16px;">
                        </button>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button id="adminActionBtn" class="group-card-edit-btn" style="background: #222; color: #fff; font-weight: 600; margin-left: 12px;">Assign admins</button>
                </div>
            </div>
        </div>
        <div class="table-wrapper" style="background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
            <div class="table-summary" id="adminTableSummary">Total {{ admins|length }} item{% if admins|length != 1 %}s{% endif %}</div>
            <table class="worker-types-table" id="adminTable">
                <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" class="admin-checkbox" id="adminSelectAll"></th>
                        <th class="sortable" data-sort="name" style="position: relative;">Admin
                            <span class="sort-icon"><img src="/static/images/arrow-small-up.png" alt="Sort"></span>
                            <img src="/static/images/menu-dots-vertical.png" alt="Menu" class="header-menu-icon" onclick="event.stopPropagation(); showHeaderDropdown(this, 'admin')">
                            <div class="header-dropdown" id="header-dropdown-admin">
                                <div class="dropdown-item" onclick="sortColumn('name', 'asc')">
                                    <img src="/static/images/arrow-small-up.png" alt="Sort Ascending">
                                    <span>Sort Ascending</span>
                                </div>
                                <div class="dropdown-item" onclick="sortColumn('name', 'desc')">
                                    <img src="/static/images/arrow-small-down.png" alt="Sort Descending">
                                    <span>Sort Descending</span>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" data-sort="role" style="position: relative;">Role
                            <span class="sort-icon"><img src="/static/images/arrow-small-up.png" alt="Sort"></span>
                            <img src="/static/images/menu-dots-vertical.png" alt="Menu" class="header-menu-icon" onclick="event.stopPropagation(); showHeaderDropdown(this, 'role')">
                            <div class="header-dropdown" id="header-dropdown-role">
                                <div class="dropdown-item" onclick="sortColumn('role', 'asc')">
                                    <img src="/static/images/arrow-small-up.png" alt="Sort Ascending">
                                    <span>Sort Ascending</span>
                                </div>
                                <div class="dropdown-item" onclick="sortColumn('role', 'desc')">
                                    <img src="/static/images/arrow-small-down.png" alt="Sort Descending">
                                    <span>Sort Descending</span>
                                </div>
                            </div>
                        </th>
                        <th style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody id="adminTableBody">
                    {% if admins %}
                    {% for admin in admins %}
                    <tr data-admin-id="{{ admin.id }}">
                        <td><input type="checkbox" class="admin-checkbox admin-row-checkbox"></td>
                        <td style="display: flex; align-items: center; gap: 10px;">
                            <span style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: #e5e7eb; border-radius: 50%; font-weight: 700; color: #7c3aed;">{{ admin.initials }}</span>
                            <div>
                                <div style="font-weight: 600; color: #222;">{{ admin.name }}</div>
                                <div style="font-size: 0.95rem; color: #888;">{{ admin.email }}</div>
                            </div>
                        </td>
                        <td style="color: #222; font-weight: 600;">{{ admin.role }}</td>
                        <td>
                            <div class="actions-container">
                                    <button class="edit-btn" onclick="toggleAdminActionMenu(event, '{{ admin.id }}')" title="More actions">
                                    <img src="/static/images/menu-dots-vertical.png" alt="Menu" style="width: 16px; height: 16px;">
                                </button>
                                <div class="action-menu" id="admin-menu-{{ admin.id }}">
                                    <div class="action-item remove-access" data-admin-id="{{ admin.id }}">
                                        <span style="display:inline-block;width:16px;height:16px;vertical-align:middle;margin-right:8px;">
                                            <img src="/static/images/minus-small.png" alt="Remove" style="width:16px;height:16px;vertical-align:middle;" />
                                        </span>
                                        <span>Remove access</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4">
                                <div class="empty-state">
                                    <div class="empty-state-icon"><img src="/static/images/admin.png" alt="Admin" style="width: 48px; height: 48px; opacity: 0.5;"></div>
                                    <div class="empty-state-title">No admins yet</div>
                                    <div class="empty-state-description">Assign admins to manage this group and its members</div>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

<!-- Update Remove Admin Modal to support single and bulk removal -->
<div class="remove-admin-modal-overlay" id="removeAdminModalOverlay"></div>
<div class="remove-admin-modal" id="removeAdminModal">
    <div class="remove-admin-modal-header">
        <span class="remove-admin-modal-header-spacer" aria-hidden="true"></span>
        <div class="remove-admin-modal-header-content">
            <div class="remove-admin-modal-title" id="removeAdminModalTitle">Remove admins</div>
            <div class="remove-admin-modal-subtitle" id="removeAdminModalSubtitle">From {{ group.name }}</div>
        </div>
        <button class="remove-admin-modal-close" id="removeAdminModalClose">&times;</button>
    </div>
    <div class="remove-admin-modal-admin" id="removeAdminModalAdminInfo"></div>
    <div class="remove-admin-modal-footer">
        <button class="remove-admin-modal-remove-btn" id="removeAdminModalRemove">Remove</button>
    </div>
</div>

<!-- Edit Group Name Modal -->
<div class="edit-group-modal-overlay" id="editGroupModalOverlay"></div>
<div class="edit-group-modal" id="editGroupModal">
    <div class="edit-group-modal-header">
        <h3 class="edit-group-modal-title">Edit group name</h3>
        <button class="edit-group-modal-close" id="editGroupModalClose">&times;</button>
    </div>
    <div class="edit-group-modal-content">
        <div class="edit-group-current">
            <span>Current: {{ group.name }}</span>
        </div>
        <div class="edit-group-form">
            <label for="editGroupNameInput" class="edit-group-label">Group name</label>
            <input type="text" id="editGroupNameInput" class="edit-group-input" value="{{ group.name }}" maxlength="48">
            <div class="edit-group-char-count">
                <span id="editGroupCharCount">{{ group.name|length }}</span>/48
            </div>
        </div>
    </div>
    <div class="edit-group-modal-footer">
        <button class="edit-group-save-btn" id="editGroupSaveBtn" disabled>Save changes</button>
    </div>
</div>

<!-- Archive Group Confirmation Modal -->
<div class="archive-group-modal-overlay" id="archiveGroupModalOverlay"></div>
<div class="archive-group-modal" id="archiveGroupModal">
    <div class="archive-group-modal-content">
        <div class="archive-group-modal-icon">
            <img src="/static/images/triangle-warning.png" alt="Warning" class="archive-group-modal-icon-img">
        </div>
        <h3 class="archive-group-modal-title">Confirm group archiving</h3>
        <p class="archive-group-modal-message">Are you sure you want to archive this group?</p>
        <div class="archive-group-modal-footer">
            <button class="archive-group-modal-cancel-btn" id="archiveGroupModalCancel">Cancel</button>
            <button class="archive-group-modal-confirm-btn" id="archiveGroupModalConfirm">Confirm</button>
        </div>
    </div>
</div>

<!-- Restore Group Confirmation Modal -->
<div class="archive-group-modal-overlay" id="restoreGroupModalOverlay"></div>
<div class="archive-group-modal" id="restoreGroupModal">
    <div class="archive-group-modal-content">
        <div class="archive-group-modal-icon">
            <img src="/static/images/exchange.png" alt="Restore" class="archive-group-modal-icon-img" style="width: 48px; height: 48px;">
        </div>
        <h3 class="archive-group-modal-title">Confirm group restoration</h3>
        <p class="archive-group-modal-message">Are you sure you want to restore this group?</p>
        <div class="archive-group-modal-footer">
            <button class="archive-group-modal-cancel-btn" id="restoreGroupModalCancel">Cancel</button>
            <button class="archive-group-modal-confirm-btn" id="restoreGroupModalConfirm">Confirm</button>
        </div>
    </div>
</div>

<script>
// Declare groupId at the top
let groupId = '{{ group.id }}';

// Tab persistence and switching logic
const tabs = document.querySelectorAll('.group-settings-tab');
const tabDetails = document.getElementById('tab-content-details');
const tabAdmins = document.getElementById('tab-content-admins');

// Function to get URL parameter
function getUrlParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

// Function to set URL parameter
function setUrlParameter(name, value) {
    const url = new URL(window.location);
    url.searchParams.set(name, value);
    window.history.replaceState({}, '', url);
}

// Function to switch tabs
function switchTab(tabName) {
    // Remove active class from all tabs
        tabs.forEach(t => t.classList.remove('active'));
    
    // Hide all tab contents
            tabDetails.style.display = 'none';
    tabAdmins.style.display = 'none';
    
    // Show selected tab content and add active class
    if (tabName === 'admins') {
            tabAdmins.style.display = '';
        document.querySelector('[data-tab="admins"]').classList.add('active');
        } else {
            tabDetails.style.display = '';
        document.querySelector('[data-tab="details"]').classList.add('active');
    }
    
    // Update URL parameter
    setUrlParameter('tab', tabName);
}

// Add click event listeners to tabs
tabs.forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        switchTab(tabName);
    });
});

// Initialize tab based on URL parameter or default to 'details'
function initializeTab() {
    const activeTab = getUrlParameter('tab') || 'details';
    switchTab(activeTab);
}

// Initialize tabs on page load
initializeTab();

// Admin table interactivity (sorting, searching, selection, action menu)
// Remove the renderAdminTable function and all code that references adminData, since the table is now rendered by Jinja and does not need JS for static data.
// Only keep the search, sorting, and action menu logic.
// (No renderAdminTable or adminData references here)

document.getElementById('adminSearchInput').addEventListener('input', function() {
    // This function is no longer needed as the table is rendered by Jinja.
    // The search logic is handled by the Jinja template.
});
document.getElementById('adminSearchClearBtn').addEventListener('click', function(e) {
    e.stopPropagation();
    document.getElementById('adminSearchInput').value = '';
    // This function is no longer needed as the table is rendered by Jinja.
    // The search logic is handled by the Jinja template.
});

document.querySelectorAll('#adminTable th.sortable').forEach(th => {
    th.addEventListener('click', function(e) {
        if (e.target.closest('.sort-icon')) {
            const field = this.dataset.sort;
            // This function is no longer needed as the table is rendered by Jinja.
            // The sorting logic is handled by the Jinja template.
        }
    });
});

function updateSelectAllState() {
    const selectAllCheckbox = document.getElementById('adminSelectAll');
    const rowCheckboxes = document.querySelectorAll('.admin-row-checkbox');
    const checkedCount = document.querySelectorAll('.admin-row-checkbox:checked').length;
    
    if (!selectAllCheckbox) {
        console.warn('Select all checkbox not found');
        return;
    }
    
    // Hide select all checkbox if no admin rows exist
    if (rowCheckboxes.length === 0) {
        selectAllCheckbox.style.display = 'none';
        return;
    } else {
        selectAllCheckbox.style.display = 'inline-block';
    }
    
    if (checkedCount === 0) {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = false;
    } else {
        selectAllCheckbox.checked = true;
        selectAllCheckbox.indeterminate = true; // Only show horizontal line when checked
    }
}

// Event listeners are now handled in initializeAdminFunctionality()

// Call updateSelectAllState on page load
updateSelectAllState();

// Handle empty state for admin table
function updateAdminTableState() {
    const adminTableBody = document.getElementById('adminTableBody');
    const adminActionBtn = document.getElementById('adminActionBtn');
    const adminSearchContainer = document.getElementById('adminSearchContainer');
    
    if (!adminTableBody) {
        console.warn('Admin table body not found');
        return;
    }
    
    // Check if there are any admin rows (excluding empty state row)
    const adminRows = adminTableBody.querySelectorAll('tr[data-admin-id]');
    
    if (adminRows.length === 0) {
        // No admins - disable search and action button
        if (adminSearchContainer) {
            adminSearchContainer.style.opacity = '0.5';
            adminSearchContainer.style.pointerEvents = 'none';
        }
        if (adminActionBtn) {
            adminActionBtn.textContent = 'Assign admins';
            adminActionBtn.style.background = '#222';
            adminActionBtn.style.color = '#fff';
            adminActionBtn.style.fontWeight = '600';
        }
    } else {
        // Has admins - enable search and action button
        if (adminSearchContainer) {
            adminSearchContainer.style.opacity = '1';
            adminSearchContainer.style.pointerEvents = 'auto';
        }
        if (adminActionBtn) {
            // Don't call updateAdminActionBtn here to avoid circular calls
            // The button state will be updated by the checkbox event listeners
        }
    }
}

// Call updateAdminTableState after DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateAdminTableState);
} else {
    updateAdminTableState();
}

// Header dropdown functionality
function showHeaderDropdown(button, column) {
    // Hide all other dropdowns
    document.querySelectorAll('.header-dropdown').forEach(dropdown => {
        dropdown.classList.remove('show');
    });
    
    // Show the clicked dropdown
    const dropdown = document.getElementById(`header-dropdown-${column}`);
    if (dropdown) {
        dropdown.classList.add('show');
        
        // Position the dropdown
        const buttonRect = button.getBoundingClientRect();
        const dropdownRect = dropdown.getBoundingClientRect();
        
        // Check if dropdown would go below viewport
        if (buttonRect.bottom + dropdownRect.height > window.innerHeight) {
            dropdown.classList.add('positioned-above');
        } else {
            dropdown.classList.remove('positioned-above');
        }
    }
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.header-menu-icon') && !e.target.closest('.header-dropdown')) {
        document.querySelectorAll('.header-dropdown').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
    }
});

// Sort column functionality
function sortColumn(column, direction) {
    console.log(`Sorting ${column} column in ${direction} direction`);
    // Add your sorting logic here
    // For now, just close the dropdown
    document.querySelectorAll('.header-dropdown').forEach(dropdown => {
        dropdown.classList.remove('show');
    });
}

// Edit Group Name Modal functionality
function showEditGroupNameModal() {
    const modal = document.getElementById('editGroupModal');
    const overlay = document.getElementById('editGroupModalOverlay');
    const input = document.getElementById('editGroupNameInput');
    const charCount = document.getElementById('editGroupCharCount');
    const saveBtn = document.getElementById('editGroupSaveBtn');
    
    // Reset input to current group name
    input.value = '{{ group.name }}';
    charCount.textContent = input.value.length;
    updateSaveButton();
    
    // Show modal
    modal.style.display = 'block';
    overlay.style.display = 'block';
    
    // Focus input
    setTimeout(() => {
        input.focus();
        input.select();
    }, 100);
}

function hideEditGroupModal() {
    document.getElementById('editGroupModal').style.display = 'none';
    document.getElementById('editGroupModalOverlay').style.display = 'none';
}

function updateSaveButton() {
    const input = document.getElementById('editGroupNameInput');
    const saveBtn = document.getElementById('editGroupSaveBtn');
    const currentName = '{{ group.name }}';
    
    // Enable save button only if name has changed and is not empty
    const hasChanged = input.value.trim() !== currentName;
    const isValid = input.value.trim().length > 0;
    
    saveBtn.disabled = !hasChanged || !isValid;
}

function saveGroupName() {
    const input = document.getElementById('editGroupNameInput');
    const newName = input.value.trim();
    const saveBtn = document.getElementById('editGroupSaveBtn');
    
    if (newName.length === 0) {
        alert('Group name cannot be empty');
        return;
    }
    
    // Disable save button to prevent double submission
    saveBtn.disabled = true;
    saveBtn.textContent = 'Saving...';
    
    // Make API call to update group name
    fetch(`/api/group/${groupId}/update-name`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name: newName })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update the displayed group name on the page
            const groupNameElements = document.querySelectorAll('.group-settings-title, .edit-group-current span');
            groupNameElements.forEach(element => {
                if (element.textContent.includes('{{ group.name }}') || element.textContent.includes('Current:')) {
                    element.textContent = element.textContent.replace('{{ group.name }}', newName).replace(/Current: .*/, `Current: ${newName}`);
                }
            });
            
            // Close modal and show success message
            hideEditGroupModal();
            alert('Group name updated successfully!');
        } else {
            // Show error message
            alert(data.error || 'Failed to update group name');
            // Re-enable save button
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save changes';
        }
    })
    .catch(error => {
        console.error('Error updating group name:', error);
        alert('Failed to update group name. Please try again.');
        // Re-enable save button
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save changes';
    });
}

// Add event listeners for edit group modal
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('editGroupNameInput');
    const saveBtn = document.getElementById('editGroupSaveBtn');
    const closeBtn = document.getElementById('editGroupModalClose');
    const overlay = document.getElementById('editGroupModalOverlay');
    
    if (input) {
        input.addEventListener('input', function() {
            const charCount = document.getElementById('editGroupCharCount');
            charCount.textContent = this.value.length;
            updateSaveButton();
        });
        
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !saveBtn.disabled) {
                saveGroupName();
            } else if (e.key === 'Escape') {
                hideEditGroupModal();
            }
        });
    }
    
    if (saveBtn) {
        saveBtn.addEventListener('click', saveGroupName);
    }
    
    if (closeBtn) {
        closeBtn.addEventListener('click', hideEditGroupModal);
    }
    
    if (overlay) {
        overlay.addEventListener('click', hideEditGroupModal);
    }
});

function toggleAdminActionMenu(event, adminId) {
    event.stopPropagation();
    document.querySelectorAll('.action-menu').forEach(menu => {
        if (menu.id !== `admin-menu-${adminId}`) menu.classList.remove('show');
    });
    const menu = document.getElementById(`admin-menu-${adminId}`);
    const button = event.currentTarget;
    const buttonRect = button.getBoundingClientRect();
    
    // Position the menu relative to the button
    menu.style.top = (buttonRect.bottom + 5) + 'px';
    menu.style.left = (buttonRect.left - menu.offsetWidth) + 'px';
    
    menu.classList.toggle('show');
}
document.addEventListener('click', function(e) {
    if (!e.target.closest('.actions-container')) {
        document.querySelectorAll('.action-menu').forEach(menu => menu.classList.remove('show'));
    }
});

function editAdmin(id) { alert('Edit admin ' + id); }
function copyAdmin(id) { alert('Duplicate admin ' + id); }
function deleteAdmin(id) {
    // Remove the alert. Add your removal logic here if needed.
    // (No alert or notification)
}

// Admin search functionality (like groups page)
const adminSearchContainer = document.getElementById('adminSearchContainer');
const adminSearchInput = document.getElementById('adminSearchInput');
const adminSearchIcon = document.getElementById('adminSearchIcon');
const adminSearchClearBtn = document.getElementById('adminSearchClearBtn');

// Admin search container click handler
adminSearchContainer.addEventListener('click', function() {
    if (!this.classList.contains('expanded')) {
        this.classList.add('expanded');
        adminSearchInput.focus();
    }
});

// Admin search input handlers
adminSearchInput.addEventListener('input', function() {
    const hasValue = this.value.trim().length > 0;
    adminSearchClearBtn.classList.toggle('show', hasValue);
    
    // Filter admin table based on search term
    filterAdminTable();
});

adminSearchInput.addEventListener('blur', function() {
    if (!this.value.trim()) {
        adminSearchContainer.classList.remove('expanded');
    }
});

// Clear admin search button
adminSearchClearBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    adminSearchInput.value = '';
    adminSearchContainer.classList.remove('expanded');
    this.classList.remove('show');
    filterAdminTable();
});

// Click outside to collapse admin search
document.addEventListener('click', function(e) {
    if (!adminSearchContainer.contains(e.target) && !adminSearchInput.value.trim()) {
        adminSearchContainer.classList.remove('expanded');
    }
});

// Filter admin table function
function filterAdminTable() {
    const searchTerm = adminSearchInput.value.trim().toLowerCase();
    const adminRows = document.querySelectorAll('#adminTableBody tr');
    let visibleCount = 0;
    
    adminRows.forEach(row => {
        const nameCell = row.querySelector('div div:first-child'); // Admin name
        const emailCell = row.querySelector('div div:last-child'); // Admin email
        
        if (nameCell && emailCell) {
            const name = nameCell.textContent.toLowerCase();
            const email = emailCell.textContent.toLowerCase();
            const matchesSearch = !searchTerm || name.includes(searchTerm) || email.includes(searchTerm);
            
            row.style.display = matchesSearch ? 'table-row' : 'none';
            if (matchesSearch) visibleCount++;
        }
    });
    
    // Update table summary
    const tableSummary = document.getElementById('adminTableSummary');
    if (tableSummary) {
        tableSummary.textContent = `Total ${visibleCount} item${visibleCount !== 1 ? 's' : ''}`;
    }
}

// Initial render
// This function is no longer needed as the table is rendered by Jinja.
// The initial render logic is handled by the Jinja template.

let removeAdminMode = 'single'; // 'single' or 'bulk'
let adminsToRemove = [];

function showRemoveAdminModal(adminIds) {
    removeAdminMode = Array.isArray(adminIds) && adminIds.length > 1 ? 'bulk' : 'single';
    adminsToRemove = Array.isArray(adminIds) ? adminIds : [adminIds];
    const modal = document.getElementById('removeAdminModal');
    const overlay = document.getElementById('removeAdminModalOverlay');
    const adminInfoDiv = document.getElementById('removeAdminModalAdminInfo');
    const title = document.getElementById('removeAdminModalTitle');
    if (removeAdminMode === 'bulk') {
        title.textContent = 'Remove admins';
        adminInfoDiv.innerHTML = `<div style='font-size:1rem;color:#222;'>Are you sure you want to remove access for <b>${adminsToRemove.length}</b> selected admins?</div>`;
    } else {
        title.textContent = 'Remove admin';
        // Find admin info from table row
        const row = document.querySelector(`tr[data-admin-id="${adminsToRemove[0]}"]`);
        if (row) {
            const avatar = row.querySelector('span[style*="border-radius: 50%"]');
            const name = row.querySelector('div[style*="font-weight: 600"]');
            const role = row.querySelector('div[style*="font-size: 0.95rem"]');
            adminInfoDiv.innerHTML = `<div class='remove-admin-modal-avatar'>${avatar ? avatar.outerHTML : ''}</div><div class='remove-admin-modal-admin-info'><div class='remove-admin-modal-admin-name'>${name ? name.textContent : ''}</div><div class='remove-admin-modal-admin-role'>${role ? role.textContent : ''}</div></div>`;
        } else {
            adminInfoDiv.innerHTML = '';
        }
    }
    modal.style.display = 'block';
    overlay.style.display = 'block';
}
function hideRemoveAdminModal() {
    document.getElementById('removeAdminModal').style.display = 'none';
    document.getElementById('removeAdminModalOverlay').style.display = 'none';
    adminsToRemove = [];
}
document.getElementById('removeAdminModalClose').onclick = hideRemoveAdminModal;
document.getElementById('removeAdminModalOverlay').onclick = hideRemoveAdminModal;
document.getElementById('removeAdminModalRemove').onclick = function() {
    if (!adminsToRemove.length) return;
    fetch(`/api/group/${parseInt(groupId)}/admin/bulk-remove`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_ids: adminsToRemove })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            window.location.reload();
        } else {
            alert(data.error || 'Failed to remove admin(s)');
        }
    })
    .catch(() => alert('Failed to remove admin(s)'));
};

// Initialize admin functionality when DOM is ready
function initializeAdminFunctionality() {
const adminActionBtn = document.getElementById('adminActionBtn');
const adminCheckboxes = document.querySelectorAll('.admin-row-checkbox');
    const adminSelectAll = document.getElementById('adminSelectAll');
    
    if (!adminActionBtn) {
        console.warn('Admin action button not found');
        return;
    }

// Dropdown Remove access
document.querySelectorAll('.action-item.remove-access').forEach(item => {
    item.onclick = function() {
        const adminId = this.getAttribute('data-admin-id');
        if (!adminId) return;
        showRemoveAdminModal(adminId);
    };
});

// Bulk Remove access button
adminActionBtn.onclick = function() {
    const checked = document.querySelectorAll('.admin-row-checkbox:checked');
    if (checked.length > 0) {
        const ids = Array.from(checked).map(cb => cb.closest('tr').getAttribute('data-admin-id'));
        showRemoveAdminModal(ids);
    } else {
            window.location.href = `/assign-admin/${parseInt(groupId)}`;
    }
};

function updateAdminActionBtn() {
    const checked = document.querySelectorAll('.admin-row-checkbox:checked');
    if (checked.length > 0) {
        adminActionBtn.textContent = 'Remove access';
        adminActionBtn.style.background = '#f5f5f5';
        adminActionBtn.style.color = '#222';
        adminActionBtn.style.fontWeight = '500';
        adminActionBtn.style.border = 'none';
        adminActionBtn.style.boxShadow = 'none';
        adminActionBtn.style.borderRadius = '12px';
        adminActionBtn.style.padding = '8px 18px';
        adminActionBtn.onclick = function() {
            const ids = Array.from(document.querySelectorAll('.admin-row-checkbox:checked')).map(cb => cb.closest('tr').getAttribute('data-admin-id'));
            showRemoveAdminModal(ids);
        };
    } else {
        adminActionBtn.textContent = 'Assign admins';
        adminActionBtn.style.background = '#222';
        adminActionBtn.style.color = '#fff';
        adminActionBtn.style.fontWeight = '600';
        adminActionBtn.style.border = '';
        adminActionBtn.style.boxShadow = '';
        adminActionBtn.style.borderRadius = '';
        adminActionBtn.style.padding = '';
        adminActionBtn.onclick = function() {
                window.location.href = `/assign-admin/${parseInt(groupId)}`;
            };
        }
    }

    // Add event listeners to individual row checkboxes
    adminCheckboxes.forEach(cb => {
        cb.addEventListener('change', function() {
            updateAdminActionBtn();
            updateSelectAllState();
        });
    });

    // Add event listener to select all checkbox
    if (adminSelectAll) {
        adminSelectAll.addEventListener('change', function() {
    document.querySelectorAll('.admin-row-checkbox').forEach(cb => {
        cb.checked = this.checked;
    });
    updateSelectAllState();
    updateAdminActionBtn();
});
    }

    // Initialize button state
updateAdminActionBtn();
}

// Call initialization when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAdminFunctionality);
} else {
    initializeAdminFunctionality();
}

// Archive Group Modal functionality
function showArchiveGroupModal() {
    const modal = document.getElementById('archiveGroupModal');
    const overlay = document.getElementById('archiveGroupModalOverlay');
    
    // Show modal
    modal.style.display = 'block';
    overlay.style.display = 'block';
}

function hideArchiveGroupModal() {
    const modal = document.getElementById('archiveGroupModal');
    const overlay = document.getElementById('archiveGroupModalOverlay');
    
    // Hide modal
    modal.style.display = 'none';
    overlay.style.display = 'none';
}

function archiveGroup() {
    const confirmBtn = document.getElementById('archiveGroupModalConfirm');
    
    // Disable confirm button to prevent double submission
    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Archiving...';
    
    // Make API call to archive group
    fetch(`/api/group/${groupId}/archive`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update the group status on the page
            const statusBadge = document.querySelector('.status-badge');
            if (statusBadge) {
                statusBadge.textContent = 'ARCHIVED';
                statusBadge.classList.add('archived');
            }
            
            // Close modal and show success message
            hideArchiveGroupModal();
            alert('Group archived successfully!');
            
            // Redirect to groups page after a short delay
            setTimeout(() => {
                window.location.href = '/groups';
            }, 1500);
        } else {
            // Show error message
            alert(data.error || 'Failed to archive group');
            // Re-enable confirm button
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'Confirm';
        }
    })
    .catch(error => {
        console.error('Error archiving group:', error);
        alert('Failed to archive group. Please try again.');
        // Re-enable confirm button
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm';
    });
}

// Add event listeners for archive group modal
document.addEventListener('DOMContentLoaded', function() {
    const cancelBtn = document.getElementById('archiveGroupModalCancel');
    const confirmBtn = document.getElementById('archiveGroupModalConfirm');
    const overlay = document.getElementById('archiveGroupModalOverlay');
    
    if (cancelBtn) {
        cancelBtn.addEventListener('click', hideArchiveGroupModal);
    }
    
    if (confirmBtn) {
        confirmBtn.addEventListener('click', archiveGroup);
    }
    
    if (overlay) {
        overlay.addEventListener('click', hideArchiveGroupModal);
    }
});

// Restore Group Modal functionality
function showRestoreGroupModal() {
    const modal = document.getElementById('restoreGroupModal');
    const overlay = document.getElementById('restoreGroupModalOverlay');
    
    // Show modal
    modal.style.display = 'block';
    overlay.style.display = 'block';
}

function hideRestoreGroupModal() {
    const modal = document.getElementById('restoreGroupModal');
    const overlay = document.getElementById('restoreGroupModalOverlay');
    
    // Hide modal
    modal.style.display = 'none';
    overlay.style.display = 'none';
}

function restoreGroup() {
    const confirmBtn = document.getElementById('restoreGroupModalConfirm');
    
    // Disable confirm button to prevent double submission
    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Restoring...';
    
    // Make API call to restore group
    fetch(`/api/group/${groupId}/restore`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update the group status on the page
            const statusBadge = document.querySelector('.status-badge');
            if (statusBadge) {
                statusBadge.textContent = 'ACTIVE';
                statusBadge.classList.remove('archived');
            }
            
            // Close modal and show success message
            hideRestoreGroupModal();
            alert('Group restored successfully!');
            
            // Redirect to groups page after a short delay
            setTimeout(() => {
                window.location.href = '/groups';
            }, 1500);
        } else {
            // Show error message
            alert(data.error || 'Failed to restore group');
            // Re-enable confirm button
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'Confirm';
        }
    })
    .catch(error => {
        console.error('Error restoring group:', error);
        alert('Failed to restore group. Please try again.');
        // Re-enable confirm button
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm';
    });
}

// Add event listeners for restore group modal
document.addEventListener('DOMContentLoaded', function() {
    const restoreCancelBtn = document.getElementById('restoreGroupModalCancel');
    const restoreConfirmBtn = document.getElementById('restoreGroupModalConfirm');
    const restoreOverlay = document.getElementById('restoreGroupModalOverlay');
    
    if (restoreCancelBtn) {
        restoreCancelBtn.addEventListener('click', hideRestoreGroupModal);
    }
    
    if (restoreConfirmBtn) {
        restoreConfirmBtn.addEventListener('click', restoreGroup);
    }
    
    if (restoreOverlay) {
        restoreOverlay.addEventListener('click', hideRestoreGroupModal);
    }
});


</script>
{% endblock %} 