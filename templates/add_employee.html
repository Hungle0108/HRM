<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add person - HR Management System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .page-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 20px 40px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding-left: calc(50% - 460px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .top-bar-content {
            max-width: 930px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #333;
        }

        .page-header {
            background: white;
            padding: 40px 40px 20px 40px;
            display: flex;
            justify-content: flex-start;
            padding-left: calc(50% - 470px);
            margin-top: 80px;
        }

        .page-header-content {
            max-width: 600px;
            width: 100%;
            text-align: left;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 1rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .main-container {
            flex: 1;
            display: flex;
            background: white;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 40px 120px 40px;
            gap: 60px;
        }

        .content-area {
            flex: 0 0 auto;
            max-width: 600px;
            width: 100%;
        }

        .sidebar {
            flex: 0 0 auto;
            width: 280px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 30px 25px;
            height: fit-content;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 30px;
        }

        .steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-item {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 16px;
            font-size: 0.9rem;
        }

        .step-item.active .step-number {
            background: #1a1a1a;
            color: white;
        }

        .step-item.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-item:not(.active):not(.completed) .step-number {
            background: #e9ecef;
            color: #6c757d;
        }

        .step-item.active .step-text {
            color: #1a1a1a;
            font-weight: 600;
        }

        .step-item:not(.active) .step-text {
            color: #6c757d;
        }

        .help-section {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid #e9ecef;
        }

        .help-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        .form-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }

        .form-input, .form-select {
            padding: 14px 16px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        /* Enhanced dropdown styling */
        .form-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23666666' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 16px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 48px;
            cursor: pointer;
        }

        .form-select:hover {
            border-color: #adb5bd;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23495057' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }

        .form-select:focus {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23007bff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }

        /* Improved option styling */
        .form-select option {
            padding: 12px 16px;
            font-size: 0.95rem;
            color: #495057;
            background: white;
        }

        .form-select option:hover {
            background-color: #f8f9fa;
        }

        .form-input::placeholder {
            color: #999;
        }

        .dropdown-wrapper {
            position: relative;
            width: 100%;
        }

        .dropdown-wrapper .form-input {
            width: 100%;
            box-sizing: border-box;
        }

        #employeeCitizenshipInput,
        #employeeResidenceInput {
            width: 100% !important;
            box-sizing: border-box !important;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none;
            width: 100%;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            color: #495057;
            border-bottom: 1px solid #f8f9fa;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .error-icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e9ecef;
            padding: 20px 40px;
            display: flex;
            justify-content: center;
            z-index: 1000;
        }

        .bottom-nav-content {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-back {
            background: white;
            border: 1px solid #e9ecef;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-back:hover {
            background: #f8f9fa;
            border-color: #d1d5db;
        }

        .btn-continue {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-continue:hover {
            background: #333;
        }

        .saved-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 0.9rem;
        }

        .saved-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Custom year dropdown button */
        .year-dropdown-btn {
            margin-left: 2px;
            padding: 2px 4px;
            background: none;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: background-color 0.2s;
            font-size: 12px;
            color: #666;
        }

        .year-dropdown-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .year-dropdown-btn.active {
            background-color: rgba(0, 0, 0, 0.15);
        }

        /* Hide default year navigation arrows */
        .flatpickr-current-month .numInputWrapper::after,
        .flatpickr-current-month .numInputWrapper::before {
            display: none !important;
        }

        .flatpickr-current-month .arrowUp,
        .flatpickr-current-month .arrowDown {
            display: none !important;
        }

        /* Navigation arrows container */
        .flatpickr-months {
            position: relative;
        }

        .flatpickr-months .flatpickr-prev-month,
        .flatpickr-months .flatpickr-next-month {
            position: static;
            height: 32px;
            width: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }

        .flatpickr-months .flatpickr-prev-month svg,
        .flatpickr-months .flatpickr-next-month svg {
            width: 20px;
            height: 20px;
            fill: none !important;
            stroke: #000;
            stroke-width: 2;
        }

        /* Group the navigation buttons together */
        .flatpickr-months .flatpickr-prev-month,
        .flatpickr-months .flatpickr-next-month {
            order: 2;
        }

        .flatpickr-current-month {
            order: 1;
        }

        /* Hide any remaining toggle indicators */
        .numInputWrapper::after,
        .flatpickr-current-month .cur-month::after,
        .flatpickr-current-month .flatpickr-monthDropdown-months::after,
        .flatpickr-current-month select::after,
        .flatpickr-current-month select::-ms-expand {
            display: none !important;
        }

        .flatpickr-current-month select,
        .flatpickr-current-month .flatpickr-monthDropdown-months,
        .numInput.cur-year {
            background: transparent !important;
            border: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            pointer-events: none !important;
            cursor: default !important;
            padding: 0;
            text-align: left !important;
            font-variant-numeric: tabular-nums !important;
            letter-spacing: 0 !important;
            margin: 0 !important;
            display: inline-block !important;
        }

        /* Specific width for month dropdown */
        .flatpickr-current-month select,
        .flatpickr-current-month .flatpickr-monthDropdown-months {
            width: 85px !important;
            margin-right: 8px !important;
        }

        /* Specific width for year input */
        .numInput.cur-year {
            width: 55px !important;
        }

        /* Add spacing to current month container */
        .flatpickr-current-month {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }

        /* Flatpickr custom styling for disabled future navigation */
        .flatpickr-calendar .flatpickr-next-month.disabled,
        .flatpickr-calendar .flatpickr-prev-month.disabled {
            opacity: 0.3 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
            filter: grayscale(100%) !important;
            /* Keep the button visible but clearly disabled */
            display: flex !important;
            visibility: visible !important;
        }

        .flatpickr-calendar .flatpickr-next-month.disabled:hover,
        .flatpickr-calendar .flatpickr-prev-month.disabled:hover {
            background: transparent !important;
            opacity: 0.3 !important;
        }

        .flatpickr-calendar .flatpickr-next-month.disabled svg,
        .flatpickr-calendar .flatpickr-prev-month.disabled svg {
            color: #ccc !important;
            opacity: 0.5 !important;
        }

        /* Year selection grid - now inside the calendar */
        .year-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            border-radius: 8px;
            z-index: 1000;
            padding: 10px;
            display: none !important; /* Hidden by default */
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        .year-grid.show {
            display: block !important;
        }

        .year-grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        .year-option {
            padding: 6px 2px;
            text-align: center;
            cursor: pointer;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
            background: #f8f9fa;
            box-sizing: border-box;
            min-width: 0;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            overflow: hidden;
        }

        .year-option:hover {
            background-color: #e9ecef;
            border-color: #d1d5db;
        }

        .year-option.selected {
            background-color: #000;
            color: white;
            border-color: #000;
        }

        .year-option.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background-color: #f9f9f9;
            color: #ccc;
        }

        .year-option.disabled:hover {
            background-color: #f9f9f9;
            border-color: transparent;
        }

        /* Hide calendar content when year grid is shown */
        .flatpickr-calendar.year-mode .flatpickr-days,
        .flatpickr-calendar.year-mode .flatpickr-weekdays {
            display: none !important;
        }

        /* Hide month navigation buttons in year mode */
        .flatpickr-calendar.year-mode .flatpickr-prev-month,
        .flatpickr-calendar.year-mode .flatpickr-next-month {
            display: none !important;
        }

        /* Calendar in year mode - smaller and more contained */
        .flatpickr-calendar.year-mode {
            width: 280px !important;
            height: 320px !important;
            max-width: 280px !important;
            max-height: 320px !important;
            overflow: hidden !important;
        }

        .flatpickr-calendar.year-mode .year-grid {
            display: block !important;
            position: absolute !important;
            top: 45px !important;
            left: 8px !important;
            right: 8px !important;
            bottom: 8px !important;
            width: calc(100% - 16px) !important;
            height: calc(100% - 53px) !important;
            max-width: 264px !important;
            max-height: 267px !important;
        }

        /* Hide dates from other months completely */
        .flatpickr-day.prevMonthDay,
        .flatpickr-day.nextMonthDay {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* Calendar days */
        .flatpickr-day {
            width: 40px;
            height: 40px;
            line-height: 40px;
            font-size: 14px;
            border-radius: 50%;
            margin: 2px 0;
            color: #000;
            opacity: 0.7;
            border: none;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            flex: 0 0 40px;
        }

        .flatpickr-day:hover {
            background: #e2e2e2;
            opacity: 1;
        }

        .flatpickr-day.selected {
            background: #000;
            color: #fff;
            opacity: 1;
        }

        .flatpickr-days {
            width: 100% !important;
            padding: 0;
        }

        .dayContainer {
            width: 100%;
            min-width: 100%;
            max-width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            padding: 0 2px;
            outline: 0;
            text-align: left;
        }

        /* Date input specific styles */
        .date-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            border: 1px solid #ced4da;
            border-radius: 8px;
            background: white;
            transition: all 0.2s;
        }

        .date-input-wrapper:focus-within {
            border-color: #80bdff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .form-input.date-input {
            border: none;
            padding: 14px 16px;
            padding-right: 50px;
            box-shadow: none;
            flex: 1;
            background: transparent;
            cursor: pointer;
        }

        .form-input.date-input:focus {
            border: none;
            box-shadow: none;
            outline: none;
        }

        .calendar-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }

        .calendar-icon:hover {
            color: #495057;
        }

        .calendar-icon img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            transition: all 0.2s;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Main Container -->
        <div class="main-container">
            <!-- Content Area -->
            <div class="content-area">
                <form id="employee-form">
                    <div class="form-section">
                        <h3 class="section-title">Team information</h3>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label required">Office</label>
                                <select class="form-select" required>
                                    <option value="" disabled selected hidden></option>
                                    <option value="engineering">Engineering</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="sales">Sales</option>
                                    <option value="hr">Human Resources</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">Employee personal details</h3>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label required">Personal email</label>
                                <input type="email" class="form-input" required>
                                <div class="error-message" style="display: none;">
                                    <svg class="error-icon" viewBox="0 0 20 20">
                                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                                    </svg>
                                    Email is a required field
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label required">Legal first name</label>
                                <input type="text" class="form-input" required>
                                <div class="error-message" style="display: none;">
                                    <svg class="error-icon" viewBox="0 0 20 20">
                                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                                    </svg>
                                    Legal first name is required
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label required">Legal last name</label>
                                <input type="text" class="form-input" required>
                                <div class="error-message" style="display: none;">
                                    <svg class="error-icon" viewBox="0 0 20 20">
                                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                                    </svg>
                                    Legal last name is required
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Date of birth</label>
                                <div class="date-input-wrapper">
                                    <input type="text" class="form-input date-input" id="dateOfBirth" placeholder="Select date of birth" readonly>
                                    <button type="button" class="calendar-icon" id="calendarToggle">
                                        <img src="{{ url_for('static', filename='images/calendar-lines.png') }}" alt="Calendar">
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Gender</label>
                                <select class="form-select" id="genderSelect">
                                    <option value="" disabled selected hidden></option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Work email address (optional)</label>
                                <input type="email" class="form-input">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Employee's citizenship (optional)</label>
                                <div class="dropdown-wrapper">
                                    <input type="text" class="form-input" id="employeeCitizenshipInput" autocomplete="off">
                                    <div class="dropdown-menu" id="employeeCitizenshipDropdown"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label required">Country of residence</label>
                                <div class="dropdown-wrapper">
                                    <input type="text" class="form-input" id="employeeResidenceInput" autocomplete="off" required>
                                    <div class="dropdown-menu" id="employeeResidenceDropdown"></div>
                                </div>
                                <small style="color: #6c757d;">Country the employee will be working from</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <h3 class="sidebar-title">Steps</h3>
                
                <ol class="steps-list">
                    <li class="step-item active">
                        <div class="step-number">1</div>
                        <div class="step-text">Personal details</div>
                    </li>
                    <li class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-text">Job details</div>
                    </li>
                    <li class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-text">Compensation and dates</div>
                    </li>
                    <li class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-text">Compliance</div>
                    </li>
                    <li class="step-item">
                        <div class="step-number">5</div>
                        <div class="step-text">Benefits and extras</div>
                    </li>
                    <li class="step-item">
                        <div class="step-number">6</div>
                        <div class="step-text">Review</div>
                    </li>
                </ol>

                <div class="help-section">
                    <div class="help-title">
                        Help and support
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-navigation">
            <div class="bottom-nav-content">
                <button type="button" class="btn-back" id="backButton" onclick="window.location.href='/add-people'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back
                </button>
                <button type="submit" class="btn-continue" form="employee-form">Continue</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
    <script>
    // Track which fields have been interacted with
    const interactedFields = new Set();
    
    // Track current step (1 = Personal details, 2 = Job details, etc.)
    let currentStep = 1;
    const totalSteps = 6;

    // Function to save form data to sessionStorage
    function saveFormData() {
        const formData = {
            group: document.querySelector('select[class="form-select"]').value,
            personalEmail: document.querySelector('input[type="email"]').value,
            firstName: document.querySelectorAll('input[type="text"]')[0].value,
            lastName: document.querySelectorAll('input[type="text"]')[1].value,
            dateOfBirth: document.getElementById('dateOfBirth').value,
            gender: document.getElementById('genderSelect').value,
            workEmail: document.querySelectorAll('input[type="email"]')[1].value,
            citizenship: document.getElementById('employeeCitizenshipInput').value,
            residence: document.getElementById('employeeResidenceInput').value
        };
        sessionStorage.setItem('employeeFormData', JSON.stringify(formData));
        
        // Show auto-save indicator (if you want to add visual feedback)
        console.log('Form data auto-saved');
    }

    // Function to restore form data from sessionStorage
    function restoreFormData() {
        const savedData = sessionStorage.getItem('employeeFormData');
        if (savedData) {
            const formData = JSON.parse(savedData);
            
            // Restore form values
            if (formData.group) document.querySelector('select[class="form-select"]').value = formData.group;
            if (formData.personalEmail) document.querySelector('input[type="email"]').value = formData.personalEmail;
            if (formData.firstName) document.querySelectorAll('input[type="text"]')[0].value = formData.firstName;
            if (formData.lastName) document.querySelectorAll('input[type="text"]')[1].value = formData.lastName;
            if (formData.dateOfBirth) document.getElementById('dateOfBirth').value = formData.dateOfBirth;
            if (formData.gender) document.getElementById('genderSelect').value = formData.gender;
            if (formData.workEmail) document.querySelectorAll('input[type="email"]')[1].value = formData.workEmail;
            if (formData.citizenship) document.getElementById('employeeCitizenshipInput').value = formData.citizenship;
            if (formData.residence) document.getElementById('employeeResidenceInput').value = formData.residence;
        }
    }

    // Function to clear all form data from sessionStorage
    function clearAllFormData() {
        sessionStorage.removeItem('employeeFormData');
        console.log('All form data cleared');
    }

    // Initialize form data restoration
    restoreFormData();

    // Auto-save form data when inputs change
    document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('input', saveFormData);
        input.addEventListener('change', saveFormData);
    });

    // Clear form data when user closes the form
    window.addEventListener('beforeunload', function(e) {
        // Only clear if user is navigating away from the form process
        if (!window.location.href.includes('/add-employee')) {
            clearAllFormData();
        }
    });

    // Form submission
    document.getElementById('employee-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Basic form validation
        const requiredFields = this.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                showFieldError(field);
                isValid = false;
            } else {
                hideFieldError(field);
            }
        });
        
        if (isValid) {
            // Save form data before proceeding
            saveFormData();
            // Proceed to next step
            window.location.href = '/add-employee-step2';
        }
    });

    // Add hover and blur event listeners to required fields
    document.querySelectorAll('[required]').forEach(input => {
        // Skip dropdown inputs - they should only show errors on form submission
        if (input.id === 'employeeCitizenshipInput' || input.id === 'employeeResidenceInput') {
            return;
        }
        
        let hasBeenHovered = false;

        input.addEventListener('mouseenter', function() {
            hasBeenHovered = true;
        });

        input.addEventListener('blur', function() {
            if (hasBeenHovered && !this.value.trim()) {
                interactedFields.add(this);
                showFieldError(this);
            }
        });

        input.addEventListener('input', function() {
            if (interactedFields.has(this)) {
                if (this.value.trim()) {
                    hideFieldError(this);
                } else {
                    showFieldError(this);
                }
            }
        });
    });

    function showFieldError(field) {
        field.classList.add('error');
        const errorMsg = field.parentNode.querySelector('.error-message');
        if (errorMsg) {
            errorMsg.style.display = 'flex';
        }
    }

    function hideFieldError(field) {
        field.classList.remove('error');
        const errorMsg = field.parentNode.querySelector('.error-message');
        if (errorMsg) {
            errorMsg.style.display = 'none';
        }
    }

    const countries = [
      'Afghanistan', 'Albania', 'Algeria', 'Andorra', 'Angola', 'Antigua and Barbuda', 'Argentina', 'Armenia', 'Australia', 'Austria', 'Azerbaijan',
      'Bahamas', 'Bahrain', 'Bangladesh', 'Barbados', 'Belarus', 'Belgium', 'Belize', 'Benin', 'Bhutan', 'Bolivia', 'Bosnia and Herzegovina', 'Botswana', 'Brazil', 'Brunei', 'Bulgaria', 'Burkina Faso', 'Burundi',
      'Cabo Verde', 'Cambodia', 'Cameroon', 'Canada', 'Central African Republic', 'Chad', 'Chile', 'China', 'Colombia', 'Comoros', 'Congo', 'Costa Rica', 'Croatia', 'Cuba', 'Cyprus', 'Czech Republic',
      'Denmark', 'Djibouti', 'Dominica', 'Dominican Republic',
      'Ecuador', 'Egypt', 'El Salvador', 'Equatorial Guinea', 'Eritrea', 'Estonia', 'Eswatini', 'Ethiopia',
      'Fiji', 'Finland', 'France',
      'Gabon', 'Gambia', 'Georgia', 'Germany', 'Ghana', 'Greece', 'Grenada', 'Guatemala', 'Guinea', 'Guinea-Bissau', 'Guyana',
      'Haiti', 'Honduras', 'Hungary',
      'Iceland', 'India', 'Indonesia', 'Iran', 'Iraq', 'Ireland', 'Israel', 'Italy', 'Ivory Coast',
      'Jamaica', 'Japan', 'Jordan',
      'Kazakhstan', 'Kenya', 'Kiribati', 'Kuwait', 'Kyrgyzstan',
      'Laos', 'Latvia', 'Lebanon', 'Lesotho', 'Liberia', 'Libya', 'Liechtenstein', 'Lithuania', 'Luxembourg',
      'Madagascar', 'Malawi', 'Malaysia', 'Maldives', 'Mali', 'Malta', 'Marshall Islands', 'Mauritania', 'Mauritius', 'Mexico', 'Micronesia', 'Moldova', 'Monaco', 'Mongolia', 'Montenegro', 'Morocco', 'Mozambique', 'Myanmar',
      'Namibia', 'Nauru', 'Nepal', 'Netherlands', 'New Zealand', 'Nicaragua', 'Niger', 'Nigeria', 'North Korea', 'North Macedonia', 'Norway',
      'Oman',
      'Pakistan', 'Palau', 'Palestine', 'Panama', 'Papua New Guinea', 'Paraguay', 'Peru', 'Philippines', 'Poland', 'Portugal',
      'Qatar',
      'Romania', 'Russia', 'Rwanda',
      'Saint Kitts and Nevis', 'Saint Lucia', 'Saint Vincent and the Grenadines', 'Samoa', 'San Marino', 'Sao Tome and Principe', 'Saudi Arabia', 'Senegal', 'Serbia', 'Seychelles', 'Sierra Leone', 'Singapore', 'Slovakia', 'Slovenia', 'Solomon Islands', 'Somalia', 'South Africa', 'South Korea', 'South Sudan', 'Spain', 'Sri Lanka', 'Sudan', 'Suriname', 'Sweden', 'Switzerland', 'Syria',
      'Taiwan', 'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 'Tonga', 'Trinidad and Tobago', 'Tunisia', 'Turkey', 'Turkmenistan', 'Tuvalu',
      'Uganda', 'Ukraine', 'United Arab Emirates', 'United Kingdom', 'United States', 'Uruguay', 'Uzbekistan',
      'Vanuatu', 'Vatican City', 'Venezuela', 'Vietnam',
      'Yemen',
      'Zambia', 'Zimbabwe'
    ];

    // Initialize date picker
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('dateOfBirth');
        const calendarToggle = document.getElementById('calendarToggle');

        if (dateInput && calendarToggle) {
            const fp = flatpickr(dateInput, {
                dateFormat: "Y-m-d",
                maxDate: "today",
                minDate: "1900-01-01",
                defaultDate: null,
                clickOpens: true,
                allowInput: false,
                static: false, // Allow popup to float freely outside container
                showMonths: 1,
                fixedHeight: false, // Disable to prevent interference with year mode height
                showOutsideDays: false,
                disableMobile: true, // Ensure our custom navigation works
                onChange: function(selectedDates, dateStr) {
                    console.log('Date selected:', dateStr);
                    saveFormData(); // Save form data when date changes
                },
                onMonthChange: function(selectedDates, dateStr, instance) {
                    // Check and disable navigation buttons after month change
                    setTimeout(() => {
                        checkAndDisableNavigation(instance);
                        setupYearDropdown(instance); // Re-setup year dropdown after month change
                    }, 10);
                },
                onYearChange: function(selectedDates, dateStr, instance) {
                    // Check and disable navigation buttons after year change
                    setTimeout(() => {
                        checkAndDisableNavigation(instance);
                        setupYearDropdown(instance); // Re-setup year dropdown after year change
                    }, 10);
                },
                onOpen: function(selectedDates, dateStr, instance) {
                    // Check and disable navigation buttons when calendar opens
                    setTimeout(() => {
                        checkAndDisableNavigation(instance);
                        setupYearDropdown(instance); // Setup year dropdown when calendar opens
                    }, 10);
                },
                onReady: function(selectedDates, dateStr, instance) {
                    // Check and disable navigation buttons when calendar is ready
                    setTimeout(() => {
                        checkAndDisableNavigation(instance);
                        setupYearDropdown(instance); // Setup year dropdown when calendar is ready
                    }, 10);
                }
            });

            // Initial check after flatpickr is created
            setTimeout(() => {
                checkAndDisableNavigation(fp);
                setupYearDropdown(fp); // Setup year dropdown initially
            }, 50);

            // Function to check and disable future navigation
            function checkAndDisableNavigation(instance) {
                if (!instance || !instance.calendarContainer) return;
                
                const calendar = instance.calendarContainer;
                const nextButton = calendar.querySelector('.flatpickr-next-month');
                const prevButton = calendar.querySelector('.flatpickr-prev-month');
                
                if (nextButton && prevButton) {
                    const currentMonth = instance.currentMonth;
                    const currentYear = instance.currentYear;
                    
                    // Use today's date for max navigation
                    const today = new Date();
                    
                    // Calculate the first day of the next month that would be shown
                    const nextMonth = new Date(currentYear, currentMonth + 1, 1);
                    
                    // Calculate the first day of the previous month that would be shown
                    const prevMonth = new Date(currentYear, currentMonth - 1, 1);
                    
                    // Always keep the button visible, but disable functionality and obscure appearance for future months
                    if (nextMonth > today) {
                        nextButton.classList.add('disabled');
                        // Make button visually obscured but still visible
                        nextButton.style.opacity = '0.3';
                        nextButton.style.cursor = 'not-allowed';
                        nextButton.style.pointerEvents = 'none'; // Prevent clicking
                        // Add a subtle filter to make it more obviously disabled
                        nextButton.style.filter = 'grayscale(100%)';
                    } else {
                        nextButton.classList.remove('disabled');
                        // Make button fully visible and functional
                        nextButton.style.opacity = '1';
                        nextButton.style.cursor = 'pointer';
                        nextButton.style.pointerEvents = 'auto'; // Allow clicking
                        nextButton.style.filter = 'none'; // Remove any filters
                    }
                    
                    // Handle previous button (should work until we reach the minimum date: January 1900)
                    const minDate = new Date(1900, 0, 1);
                    if (prevMonth < minDate) {
                        prevButton.classList.add('disabled');
                        prevButton.style.opacity = '0.3';
                        prevButton.style.cursor = 'not-allowed';
                        prevButton.style.pointerEvents = 'none';
                        prevButton.style.filter = 'grayscale(100%)';
                    } else {
                        prevButton.classList.remove('disabled');
                        prevButton.style.opacity = '1';
                        prevButton.style.cursor = 'pointer';
                        prevButton.style.pointerEvents = 'auto';
                        prevButton.style.filter = 'none';
                    }
                }
            }

            // Override the default click handlers to respect our disabled state
            const originalNextMonth = fp.nextMonth;
            const originalPrevMonth = fp.prevMonth;
            
            fp.nextMonth = function() {
                if (!fp.calendarContainer) return;
                
                const calendar = fp.calendarContainer;
                const nextButton = calendar.querySelector('.flatpickr-next-month');
                
                if (nextButton && !nextButton.classList.contains('disabled')) {
                    originalNextMonth.call(fp);
                    setTimeout(() => {
                        checkAndDisableNavigation(fp);
                    }, 10);
                }
            };
            
            fp.prevMonth = function() {
                if (!fp.calendarContainer) return;
                
                const calendar = fp.calendarContainer;
                const prevButton = calendar.querySelector('.flatpickr-prev-month');
                
                if (prevButton && !prevButton.classList.contains('disabled')) {
                    originalPrevMonth.call(fp);
                    setTimeout(() => {
                        checkAndDisableNavigation(fp);
                    }, 10);
                }
            };

            calendarToggle.addEventListener('click', (e) => {
                e.preventDefault();
                if (fp) {
                    fp.toggle();
                }
            });

            // Function to setup year dropdown functionality
            function setupYearDropdown(instance) {
                if (!instance || !instance.calendarContainer) return;
                
                const calendar = instance.calendarContainer;
                const currentMonthContainer = calendar.querySelector('.flatpickr-current-month');
                
                if (!currentMonthContainer) return;
                
                // Remove existing year dropdown if it exists
                const existingDropdownBtn = currentMonthContainer.querySelector('.year-dropdown-btn');
                const existingYearGrid = calendar.querySelector('.year-grid');
                if (existingDropdownBtn) existingDropdownBtn.remove();
                if (existingYearGrid) existingYearGrid.remove();
                
                // Create year dropdown button
                const yearDropdownBtn = document.createElement('button');
                yearDropdownBtn.className = 'year-dropdown-btn';
                yearDropdownBtn.innerHTML = '▼'; // Down arrow
                yearDropdownBtn.type = 'button';
                
                // Create year grid container
                const yearGrid = document.createElement('div');
                yearGrid.className = 'year-grid';
                
                const yearGridContainer = document.createElement('div');
                yearGridContainer.className = 'year-grid-container';
                
                // Generate years from 1900 to current year
                const currentYear = instance.currentYear;
                const maxYear = new Date().getFullYear();
                const minYear = 1900;
                
                for (let year = maxYear; year >= minYear; year--) {
                    const yearOption = document.createElement('div');
                    yearOption.className = 'year-option';
                    yearOption.textContent = year;
                    
                    if (year === currentYear) {
                        yearOption.classList.add('selected');
                    }
                    
                    // Disable future years beyond current year
                    if (year > maxYear) {
                        yearOption.classList.add('disabled');
                    } else {
                        yearOption.addEventListener('click', () => {
                            instance.changeYear(year);
                            // Exit year mode and return to calendar
                            calendar.classList.remove('year-mode');
                            yearDropdownBtn.classList.remove('active');
                            yearDropdownBtn.innerHTML = '▼'; // Reset to down arrow
                        });
                    }
                    
                    yearGridContainer.appendChild(yearOption);
                }
                
                yearGrid.appendChild(yearGridContainer);
                
                // Add click handler for dropdown button
                yearDropdownBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isYearMode = calendar.classList.contains('year-mode');
                    
                    if (isYearMode) {
                        // Exit year mode, show calendar
                        calendar.classList.remove('year-mode');
                        yearDropdownBtn.classList.remove('active');
                        yearDropdownBtn.innerHTML = '▼'; // Down arrow
                    } else {
                        // Enter year mode, hide calendar days and show year grid
                        calendar.classList.add('year-mode');
                        yearDropdownBtn.classList.add('active');
                        yearDropdownBtn.innerHTML = '▲'; // Up arrow
                        
                        // Update selected year in grid
                        const yearOptions = yearGrid.querySelectorAll('.year-option');
                        yearOptions.forEach(option => {
                            option.classList.remove('selected');
                            if (parseInt(option.textContent) === instance.currentYear) {
                                option.classList.add('selected');
                            }
                        });
                        
                        // Scroll to selected year
                        setTimeout(() => {
                            const selectedOption = yearGrid.querySelector('.year-option.selected');
                            if (selectedOption) {
                                selectedOption.scrollIntoView({ block: 'center', behavior: 'smooth' });
                            }
                        }, 10);
                    }
                });
                
                // Append dropdown button after the year
                currentMonthContainer.appendChild(yearDropdownBtn);
                
                // Insert year grid as the last child of calendar container
                calendar.appendChild(yearGrid);
            }
        }

        // Country dropdowns functionality
      function filterCountries(searchText) {
        return countries.filter(country =>
          country.toLowerCase().includes(searchText.toLowerCase())
        );
      }

        function setupCountryDropdown(inputId, dropdownId) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            
            if (!input || !dropdown) return;

      function updateDropdown(filteredCountries) {
        dropdown.innerHTML = '';
                
        if (filteredCountries.length > 0) {
          filteredCountries.forEach(country => {
            const div = document.createElement('div');
            div.className = 'dropdown-item';
            div.textContent = country;
            div.addEventListener('click', () => {
              input.value = country;
              dropdown.classList.remove('show');
            });
            dropdown.appendChild(div);
          });
          dropdown.classList.add('show');
        } else {
          dropdown.classList.remove('show');
        }
      }

      input.addEventListener('input', (e) => {
        const searchText = e.target.value;
        const filteredCountries = filterCountries(searchText);
        updateDropdown(filteredCountries);
      });

      input.addEventListener('focus', () => {
        if (input.value) {
                    const filteredCountries = filterCountries(input.value);
                    updateDropdown(filteredCountries);
        } else {
          updateDropdown(countries);
        }
      });
        }

        // Setup country dropdowns
        setupCountryDropdown('employeeCitizenshipInput', 'employeeCitizenshipDropdown');
        setupCountryDropdown('employeeResidenceInput', 'employeeResidenceDropdown');

        // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
            const dropdowns = document.querySelectorAll('.dropdown-menu');
            dropdowns.forEach(dropdown => {
                if (!dropdown.parentElement.contains(e.target)) {
          dropdown.classList.remove('show');
        }
      });
        });
    });
    </script>
</body>
</html> 